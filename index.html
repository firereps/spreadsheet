<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>FireReps Spreadsheet</title>
<style>
  :root {
    --background-color: #111827; /* Ciemniejszy szary */
    --primary-color: #1F2937; /* Ciemny szary */
    --border-color: #374151;
    --text-color: #F9FAFB;
    --text-color-muted: #9CA3AF;
    --accent-color: #DC2626; /* Czerwony */
    --accent-hover-color: #B91C1C; /* Ciemniejszy czerwony */
    
    --tag-new-bg: #e36209;
    --tag-best-bg: #dcb32a;
    --tag-budget-bg: #2ea043;
  }

  body {
    margin: 0;
    background-color: var(--background-color);
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
    color: var(--text-color);
  }

  .main-header {
    background-color: var(--primary-color);
    border-bottom: 1px solid var(--border-color);
    padding: 0 24px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: sticky;
    top: 0;
    z-index: 100;
  }

  .header-title { font-size: 20px; font-weight: 600; user-select: none; }
  .header-actions button {
    background-color: var(--accent-color);
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
    transition: background-color 0.2s ease;
  }
  .header-actions button:hover { background-color: var(--accent-hover-color); }
  .header-actions button#logout-button { background-color: #4B5563; margin-left: 10px; }
  .header-actions button#logout-button:hover { background-color: #374151; }

  .controls-container { padding: 16px 24px; display: flex; flex-direction: column; gap: 16px; }
  .search-filter-bar { display: flex; gap: 12px; }
  .filter-button {
    display: flex; align-items: center; gap: 8px; background-color: var(--accent-color);
    color: white; border: none; padding: 10px 16px; border-radius: 6px;
    font-weight: 600; font-size: 14px; cursor: pointer; transition: background-color 0.2s ease;
  }
  .filter-button:hover { background-color: var(--accent-hover-color); }
  .search-input {
    flex-grow: 1; background-color: var(--primary-color); border: 1px solid var(--border-color);
    border-radius: 6px; color: var(--text-color); padding: 0 12px; font-size: 14px;
  }
  .search-input::placeholder { color: var(--text-color-muted); }

  .category-tabs {
    display: flex; gap: 8px; overflow-x: auto; padding-bottom: 8px; border-bottom: 1px solid var(--border-color);
  }
  .category-tabs::-webkit-scrollbar { height: 4px; }
  .category-tabs::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 2px; }
  .category-tabs button {
    background-color: var(--primary-color); color: var(--text-color); border: 1px solid var(--border-color);
    padding: 8px 16px; border-radius: 16px; font-size: 14px; white-space: nowrap; cursor: pointer;
    transition: background-color 0.2s, border-color 0.2s;
  }
  .category-tabs button:hover { background-color: var(--border-color); }
  .category-tabs button.active { color: var(--accent-color); border-color: var(--accent-color); font-weight: 600; }

  #items-container {
    max-width: 1400px; margin: 24px auto 40px; display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px; padding: 0 24px;
  }

  .item-card {
    background: var(--primary-color); border: 1px solid var(--border-color); border-radius: 8px;
    overflow: hidden; display: flex; flex-direction: column; user-select: none;
    transition: transform 0.2s ease, box-shadow 0.2s ease; position: relative;
  }
  .item-card:hover { transform: translateY(-4px); box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3); }
  .item-image-wrapper { position: relative; background-color: #fff; }
  .item-card img { width: 100%; aspect-ratio: 1 / 1; object-fit: cover; display: block; }
  .card-badges { position: absolute; top: 10px; right: 10px; display: flex; gap: 6px; }
  .badge { color: white; padding: 2px 8px; font-size: 10px; font-weight: 700; border-radius: 4px; text-transform: uppercase; }
  .badge-new { background-color: var(--tag-new-bg); }
  .badge-best { background-color: var(--tag-best-bg); }
  .badge-budget { background-color: var(--tag-budget-bg); }
  .item-info { padding: 12px; display: flex; flex-direction: column; flex-grow: 1; }
  .item-title { font-weight: 600; font-size: 16px; color: var(--text-color); margin-bottom: 4px; }
  .item-description { font-size: 12px; color: var(--text-color-muted); margin-bottom: 8px; min-height: 16px; }
  .item-price { font-weight: 600; font-size: 16px; color: var(--text-color); margin-bottom: 12px; }
  .item-buy-button {
    margin-top: auto; display: block; text-align: center; background-color: var(--accent-color);
    color: white; padding: 10px; border-radius: 6px; font-weight: 600;
    text-decoration: none; transition: background-color 0.2s ease;
  }
  .item-buy-button:hover { background-color: var(--accent-hover-color); }
  .item-buy-button.disabled { background-color: var(--border-color); color: var(--text-color-muted); cursor: not-allowed; }
  .item-buy-button.disabled:hover { background-color: var(--border-color); }


  .modal-overlay {
    display: none; position: fixed; z-index: 1100; inset: 0; background: rgba(0,0,0,0.75);
    justify-content: center; align-items: center;
  }
  .modal-content {
    background: var(--primary-color); padding: 25px 30px; border-radius: 12px;
    width: 380px; box-shadow: 0 0 20px rgba(0,0,0,0.5); position: relative;
  }
  .modal-content h2 { color: var(--text-color); font-weight: 800; font-size: 22px; margin: 0 0 20px 0; text-align: center; }
  .modal-content .form-group { margin-bottom: 15px; }
  .modal-content label { display: block; margin-bottom: 5px; font-size: 14px; color: var(--text-color-muted); }
  .modal-content input {
    width: calc(100% - 24px); padding: 12px; border-radius: 8px; border: 1px solid var(--border-color);
    background-color: var(--background-color); color: var(--text-color); font-size: 16px;
  }
  .modal-content .modal-actions { display: flex; gap: 10px; margin-top: 20px; }
  .modal-content .modal-actions button {
    flex-grow: 1; border: none; padding: 12px; border-radius: 8px; font-weight: 700;
    cursor: pointer; font-size: 16px; transition: background-color 0.2s ease;
  }
  .modal-content .modal-actions .btn-primary { background-color: var(--accent-color); color: white; }
  .modal-content .modal-actions .btn-primary:hover { background-color: var(--accent-hover-color); }
  .modal-content .modal-actions .btn-secondary { background-color: var(--border-color); color: var(--text-color); }
  .modal-content .modal-actions .btn-secondary:hover { background-color: #4b5563; }
  .loader {
    display: none; position: absolute; inset: 0; background: rgba(31, 41, 55, 0.8);
    border-radius: 12px; justify-content: center; align-items: center;
  }
  .spinner {
    width: 40px; height: 40px; border: 4px solid var(--border-color);
    border-top-color: var(--accent-color); border-radius: 50%; animation: spin 1s linear infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
</style>
</head>
<body>

<header class="main-header">
  <div class="header-title">FireReps Spreadsheet</div>
  <div class="header-actions">
    <button id="login-button">Zaloguj się</button>
    <button id="add-item-button" style="display:none;">Dodaj przedmiot</button>
    <button id="logout-button" style="display:none;">Wyloguj się</button>
  </div>
</header>

<main>
  <div class="controls-container">
    <div class="search-filter-bar">
      <button class="filter-button">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2 4h12M4 8h8M6.5 12h3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg>
        <span>Filtry</span>
      </button>
      <input type="search" class="search-input" placeholder="Wyszukaj po nazwie...">
    </div>
    <div class="category-tabs">
      <button class="active">Wszystkie</button><button>Belts</button><button>Electronics</button><button>Headwear</button><button>Hoodies</button><button>Jackets</button><button>Jewelry</button><button>Others</button><button>Pants</button><button>Shoes</button><button>Shorts</button><button>Sweaters</button>
    </div>
  </div>
  <div id="items-container"></div>
</main>

<!-- Modal logowania -->
<div id="login-modal" class="modal-overlay">
  <div class="modal-content">
    <h2>Logowanie Admin</h2>
    <div class="form-group"><input id="login-username" type="text" placeholder="Nazwa uzytkownika" /></div>
    <div class="form-group"><input id="login-password" type="password" placeholder="Haslo" /></div>
    <div class="modal-actions"><button id="login-submit" class="btn-primary">Zaloguj</button></div>
  </div>
</div>

<!-- Modal dodawania przedmiotu -->
<div id="add-item-modal" class="modal-overlay">
    <div class="modal-content">
        <h2>Dodaj nowy przedmiot</h2>
        <div class="form-group"><label for="item-name-input">Nazwa przedmiotu</label><input id="item-name-input" type="text" placeholder="np. New Balance 9060" /></div>
        <div class="form-group"><label for="item-desc-input">Opis (opcjonalnie)</label><input id="item-desc-input" type="text" placeholder="np. Rozmiar 42, Stan 10/10" /></div>
        <div class="form-group"><label for="item-price-input">Cena</label><input id="item-price-input" type="number" placeholder="np. 157" /></div>
        <div class="form-group"><label for="item-link-input">Link do zakupu</label><input id="item-link-input" type="url" placeholder="https://..." /></div>
        <div class="form-group"><label for="item-image-input">Link do zdjęcia (np. Imgur)</label><input id="item-image-input" type="url" placeholder="https://i.imgur.com/..." /></div>
        <div class="modal-actions">
            <button id="add-item-cancel" class="btn-secondary">Anuluj</button>
            <button id="add-item-submit" class="btn-primary">Dodaj przedmiot</button>
        </div>
        <div class="loader" id="add-item-loader"><div class="spinner"></div></div>
    </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, onValue, push, set } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyB7tQvTVeG-WlBcvTByiKW7GfPpD52vDGw",
  authDomain: "spridszit-firerepy.firebaseapp.com",
  databaseURL: "https://spridszit-firerepy-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "spridszit-firerepy",
  storageBucket: "spridszit-firerepy.appspot.com",
  messagingSenderId: "963006920352",
  appId: "1:963006920352:web:58538b879f004c02873bc5"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// Elementy UI
const loginButton = document.getElementById("login-button");
const logoutButton = document.getElementById("logout-button");
const addItemButton = document.getElementById("add-item-button");
const itemsContainer = document.getElementById("items-container");

// Modale i ich elementy
const loginModal = document.getElementById("login-modal");
const loginSubmit = document.getElementById("login-submit");
const loginUsername = document.getElementById("login-username");
const loginPassword = document.getElementById("login-password");

const addItemModal = document.getElementById("add-item-modal");
const addItemSubmit = document.getElementById("add-item-submit");
const addItemCancel = document.getElementById("add-item-cancel");
const addItemLoader = document.getElementById("add-item-loader");
const itemNameInput = document.getElementById("item-name-input");
const itemDescInput = document.getElementById("item-desc-input");
const itemPriceInput = document.getElementById("item-price-input");
const itemLinkInput = document.getElementById("item-link-input");
const itemImageInput = document.getElementById("item-image-input");

const ADMIN_USER = "ifirelovereps";
const ADMIN_PASS = "fi123re987re098ps321";
let isAdmin = false;

// Funkcje pomocnicze do modali
const showModal = (modal) => modal.style.display = "flex";
const hideModal = (modal) => modal.style.display = "none";

// Funkcje do zarządzania stanem UI
const updateUIForAdmin = () => {
  loginButton.style.display = "none";
  addItemButton.style.display = "inline-block";
  logoutButton.style.display = "inline-block";
};
const updateUIForGuest = () => {
  loginButton.style.display = "inline-block";
  addItemButton.style.display = "none";
  logoutButton.style.display = "none";
};

// Funkcja renderująca przedmioty
function renderItems(items) {
  itemsContainer.innerHTML = "";
  for (const key in items) {
    const item = items[key];
    const card = document.createElement("div");
    card.className = "item-card";

    card.innerHTML = `
      <div class="item-image-wrapper">
        <img src="${item.image || 'https://via.placeholder.com/220'}" alt="${item.name}" loading="lazy">
        <!-- Badge logic can be added here if needed -->
      </div>
      <div class="item-info">
        <div class="item-title">${item.name || 'Brak nazwy'}</div>
        <div class="item-description">${item.description || ''}</div>
        <div class="item-price">${item.price ? `${item.price} PLN` : ''}</div>
        ${item.purchaseLink 
          ? `<a href="${item.purchaseLink}" class="item-buy-button" target="_blank" rel="noopener noreferrer">Kup</a>` 
          : `<button class="item-buy-button disabled" disabled>Brak linku</button>`
        }
      </div>
    `;
    itemsContainer.appendChild(card);
  }
}

function fetchAndRenderItems() {
  const itemsRef = ref(db, "items");
  onValue(itemsRef, (snapshot) => {
    const data = snapshot.val() || {};
    renderItems(data);
  });
}

// Logika eventów
loginButton.onclick = () => showModal(loginModal);
logoutButton.onclick = () => {
  isAdmin = false;
  updateUIForGuest();
};

addItemButton.onclick = () => showModal(addItemModal);
addItemCancel.onclick = () => hideModal(addItemModal);

loginModal.onclick = (e) => { if (e.target === loginModal) hideModal(loginModal); };
addItemModal.onclick = (e) => { if (e.target === addItemModal) hideModal(addItemModal); };

loginSubmit.onclick = () => {
  const user = loginUsername.value.trim();
  const pass = loginPassword.value.trim();
  if (user === ADMIN_USER && pass === ADMIN_PASS) {
    isAdmin = true;
    hideModal(loginModal);
    updateUIForAdmin();
  } else {
    alert("Niepoprawny login lub hasło");
  }
};

addItemSubmit.onclick = async () => {
  const name = itemNameInput.value.trim();
  const description = itemDescInput.value.trim();
  const price = itemPriceInput.value.trim();
  const purchaseLink = itemLinkInput.value.trim();
  const image = itemImageInput.value.trim();

  if (!name || !price || !purchaseLink || !image) {
    alert("Wypełnij wszystkie wymagane pola: Nazwa, Cena, Link do zakupu i Link do zdjęcia.");
    return;
  }

  const newItemData = {
    name,
    description,
    price: Number(price),
    purchaseLink,
    image,
    createdAt: new Date().toISOString()
  };

  addItemLoader.style.display = 'flex';
  
  try {
    const newItemRef = push(ref(db, 'items'));
    await set(newItemRef, newItemData);
    
    // Reset form and hide modal
    itemNameInput.value = '';
    itemDescInput.value = '';
    itemPriceInput.value = '';
    itemLinkInput.value = '';
    itemImageInput.value = '';
    hideModal(addItemModal);

  } catch (error) {
    console.error("Błąd podczas dodawania przedmiotu:", error);
    alert("Wystąpił błąd. Sprawdź konsolę, aby uzyskać więcej informacji.");
  } finally {
    addItemLoader.style.display = 'none';
  }
};

// Inicjalizacja strony
updateUIForGuest();
fetchAndRenderItems();
</script>
</body>
</html>
