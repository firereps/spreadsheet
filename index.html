<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Panel przedmiotów z Firebase</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f4f4f4;
    margin: 0; padding: 0;
  }
  header {
    background: #222;
    color: #fff;
    padding: 15px;
    text-align: center;
  }
  #login-button,
  #logout-button,
  #add-item-button,
  #login-submit,
  #item-save-btn,
  .btn-edit,
  .btn-delete,
  .btn-buy {
    font-size: 16px;
    padding: 12px 20px;
    border-radius: 8px;
    font-weight: 700;
    cursor: pointer;
    user-select: none;
  }
  #login-button {
    position: fixed;
    top: 15px;
    right: 15px;
    background: #007bff;
    border: none;
    color: white;
    z-index: 1000;
  }
  #logout-button {
    position: fixed;
    top: 15px;
    right: 15px;
    background: #dc3545;
    border: none;
    color: white;
    display: none;
    z-index: 1000;
  }
  #add-item-button {
    background: #28a745;
    border: none;
    color: white;
    margin: 15px auto;
    display: block;
    width: 150px;
  }
  #login-modal, #item-modal {
    display: none;
    position: fixed;
    z-index: 1100;
    left: 0; top: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.5);
    justify-content: center;
    align-items: center;
  }
  #login-modal.active, #item-modal.active {
    display: flex;
  }
  .modal-content {
    background: #fff;
    padding: 20px 25px;
    border-radius: 8px;
    width: 320px;
    box-shadow: 0 0 10px #0003;
    position: relative;
  }
  .modal-content h2 {
    margin-top: 0;
    margin-bottom: 15px;
    text-align: center;
  }
  .modal-content input, .modal-content textarea {
    width: 100%;
    margin-bottom: 12px;
    padding: 10px;
    font-size: 16px;
    border: 1px solid #ccc;
    border-radius: 4px;
  }
  .item-card {
    background: white;
    border-radius: 8px;
    width: 200px;
    padding: 15px;
    box-shadow: 0 0 8px #0002;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }
  .item-title {
    font-weight: bold;
    font-size: 18px;
    margin-bottom: 10px;
    min-height: 44px;
  }
  .item-desc {
    font-size: 14px;
    color: #555;
    margin-bottom: 12px;
    min-height: 60px;
  }
  .item-buttons {
    display: flex;
    justify-content: space-between;
    gap: 6px;
  }
  .btn-edit, .btn-delete {
    flex: 1;
    font-size: 15px;
    padding: 10px 14px;
    font-weight: 700;
    cursor: pointer;
    border-radius: 8px;
    user-select: none;
  }
  .btn-edit {
    background: #ffc107;
    border: none;
    color: #333;
  }
  .btn-delete {
    background: #dc3545;
    color: white;
    border: none;
  }
  .btn-buy {
    background: #28a745;
    border: none;
    color: white;
    padding: 12px 0;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 700;
    margin-top: auto;
    font-size: 17px;
    user-select: none;
  }
  #items-container {
    max-width: 900px;
    margin: 30px auto;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 15px;
  }
</style>
</head>
<body>

<header>
  <h1>Panel przedmiotów</h1>
</header>

<button id="login-button">Zaloguj się</button>
<button id="logout-button">Wyloguj się</button>

<button id="add-item-button" style="display:none;">Dodaj przedmiot</button>

<div id="items-container"></div>

<!-- modal logowania -->
<div id="login-modal">
  <div class="modal-content">
    <h2>Logowanie Admin</h2>
    <input type="text" id="login-username" placeholder="Nazwa użytkownika" />
    <input type="password" id="login-password" placeholder="Hasło" />
    <button id="login-submit">Zaloguj</button>
  </div>
</div>

<!-- modal dodawania/edycji przedmiotu -->
<div id="item-modal">
  <div class="modal-content">
    <h2 id="modal-title">Dodaj przedmiot</h2>
    <input type="text" id="item-name" placeholder="Nazwa przedmiotu" />
    <textarea id="item-desc" placeholder="Opis przedmiotu" rows="3"></textarea>
    <input type="url" id="item-link" placeholder="Link do przedmiotu (URL)" />
    <input type="url" id="item-image" placeholder="Link do obrazka (Imgur itp)" />
    <button id="item-save-btn">Zapisz</button>
  </div>
</div>

<script type="module">
// Firebase config i init
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, push, onValue, update, remove } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyB7tQvTVeG-WlBcvTByiKW7GfPpD52vDGw",
  authDomain: "spridszit-firerepy.firebaseapp.com",
  databaseURL: "https://spridszit-firerepy-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "spridszit-firerepy",
  storageBucket: "spridszit-firerepy.firebasestorage.app",
  messagingSenderId: "963006920352",
  appId: "1:963006920352:web:58538b879f004c02873bc5"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let isAdmin = false;
let editingItemKey = null;

// DOM refs
const loginButton = document.getElementById("login-button");
const logoutButton = document.getElementById("logout-button");
const addItemButton = document.getElementById("add-item-button");
const loginModal = document.getElementById("login-modal");
const itemModal = document.getElementById("item-modal");
const loginSubmit = document.getElementById("login-submit");
const itemsContainer = document.getElementById("items-container");
const modalTitle = document.getElementById("modal-title");
const itemNameInput = document.getElementById("item-name");
const itemDescInput = document.getElementById("item-desc");
const itemLinkInput = document.getElementById("item-link");
const itemImageInput = document.getElementById("item-image");
const itemSaveBtn = document.getElementById("item-save-btn");
const loginUsername = document.getElementById("login-username");
const loginPassword = document.getElementById("login-password");

// admin dane
const ADMIN_USER = "ifirelovereps";
const ADMIN_PASS = "fi123re987re098ps321";

function showLoginModal() {
  loginModal.classList.add("active");
  loginUsername.value = "";
  loginPassword.value = "";
  loginUsername.focus();
}
function hideLoginModal() {
  loginModal.classList.remove("active");
}
function showItemModal(edit = false) {
  itemModal.classList.add("active");
  if (!edit) {
    modalTitle.textContent = "Dodaj przedmiot";
    itemNameInput.value = "";
    itemDescInput.value = "";
    itemLinkInput.value = "";
    itemImageInput.value = "";
    editingItemKey = null;
  }
}
function hideItemModal() {
  itemModal.classList.remove("active");
}

function renderItems(items) {
  itemsContainer.innerHTML = "";
  for (const key in items) {
    const item = items[key];
    const card = document.createElement("div");
    card.className = "item-card";

    const titleEl = document.createElement("div");
    titleEl.className = "item-title";
    titleEl.textContent = item.name;
    card.appendChild(titleEl);

    if(item.image) {
      const imgEl = document.createElement("img");
      imgEl.src = item.image;
      imgEl.alt = item.name;
      imgEl.style.width = "100%";
      imgEl.style.borderRadius = "6px";
      imgEl.style.marginBottom = "12px";
      card.appendChild(imgEl);
    }

    const descEl = document.createElement("div");
    descEl.className = "item-desc";
    descEl.textContent = item.description;
    card.appendChild(descEl);

    if (isAdmin) {
      const btns = document.createElement("div");
      btns.className = "item-buttons";

      const editBtn = document.createElement("button");
      editBtn.className = "btn-edit";
      editBtn.textContent = "Edytuj";
      editBtn.onclick = () => {
        editingItemKey = key;
        modalTitle.textContent = "Edytuj przedmiot";
        itemNameInput.value = item.name;
        itemDescInput.value = item.description;
        itemLinkInput.value = item.link || "";
        itemImageInput.value = item.image || "";
        showItemModal(true);
      };

      const deleteBtn = document.createElement("button");
      deleteBtn.className = "btn-delete";
      deleteBtn.textContent = "Usuń";
      deleteBtn.onclick = () => {
        if (confirm("Czy na pewno chcesz usunąć ten przedmiot?")) {
          remove(ref(db, "items/" + key));
        }
      };

      btns.appendChild(editBtn);
      btns.appendChild(deleteBtn);
      card.appendChild(btns);
    }

    if (item.link) {
      const buyBtn = document.createElement("button");
      buyBtn.className = "btn-buy";
      buyBtn.textContent = "Kup teraz";
      buyBtn.onclick = () => {
        window.open(item.link, "_blank");
      };
      card.appendChild(buyBtn);
    }

    itemsContainer.appendChild(card);
  }
}

function updateUIForAdmin() {
  loginButton.style.display = "none";
  logoutButton.style.display = "block";
  addItemButton.style.display = "block";
}

function updateUIForGuest() {
  loginButton.style.display = "block";
  logoutButton.style.display = "none";
  addItemButton.style.display = "none";
}

function fetchAndRenderItems() {
  const itemsRef = ref(db, "items");
  onValue(itemsRef, (snapshot) => {
    const data = snapshot.val() || {};
    renderItems(data);
  });
}

loginButton.addEventListener("click", () => {
  showLoginModal();
});

logoutButton.addEventListener("click", () => {
  isAdmin = false;
  updateUIForGuest();
  fetchAndRenderItems();
});

loginSubmit.addEventListener("click", () => {
  const user = loginUsername.value.trim();
  const pass = loginPassword.value.trim();
  if (user === ADMIN_USER && pass === ADMIN_PASS) {
    isAdmin = true;
    hideLoginModal();
    updateUIForAdmin();
    fetchAndRenderItems();
  } else {
    alert("Niepoprawny login lub haslo");
  }
});

addItemButton.addEventListener("click", () => {
  showItemModal();
});

itemSaveBtn.addEventListener("click", () => {
  const name = itemNameInput.value.trim();
  const desc = itemDescInput.value.trim();
  const link = itemLinkInput.value.trim();
  const image = itemImageInput.value.trim();

  if (!name || !desc) {
    alert("Prosze podac nazwe i opis przedmiotu");
    return;
  }

  if (editingItemKey) {
    update(ref(db, "items/" + editingItemKey), {
      name,
      description: desc,
      link,
      image
    });
  } else {
    push(ref(db, "items"), {
      name,
      description: desc,
      link,
      image
    });
  }
  hideItemModal();
});

loginModal.addEventListener("click", (e) => {
  if (e.target === loginModal) hideLoginModal();
});

itemModal.addEventListener("click", (e) => {
  if (e.target === itemModal) hideItemModal();
});

updateUIForGuest();
fetchAndRenderItems();
</script>

</body>
</html>
