<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>FireReps Spreadsheet - Zarządzanie przedmiotami</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet" />
<style>
  body {
    font-family: 'Roboto', sans-serif;
    margin: 0;
    background-color: #fff;
    color: #202124;
    transition: filter 0.3s ease-in-out;
  }
  header {
    background-color: #f8f9fa;
    padding: 16px 24px;
    box-shadow: 0 1px 3px rgba(60,64,67,.1);
    display: flex;
    justify-content: flex-end;
    align-items: center;
    position: sticky;
    top: 0;
    z-index: 100;
  }
  .main-title {
    font-weight: 500;
    font-size: 24px;
    color: #202124;
    margin: 0;
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
  }
  #login-btn {
    padding: 8px 20px;
    font-size: 14px;
    font-weight: 500;
    color: #1a73e8;
    background: none;
    border: none;
    cursor: pointer;
    border-radius: 4px;
    transition: background-color 0.2s;
  }
  #login-btn:hover {
    background-color: rgba(26,115,232,0.1);
  }
  #item-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 24px;
    padding: 40px 20px;
    max-width: 1000px;
    margin: 0 auto;
  }
  .item-card {
    background-color: #fff;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    width: 280px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    transition: box-shadow 0.2s ease;
    position: relative;
  }
  .item-card:hover {
    box-shadow: 0 6px 18px rgba(0,0,0,0.15);
  }
  .item-card img {
    width: 100%;
    height: 180px;
    object-fit: cover;
  }
  .card-content {
    padding: 16px;
    display: flex;
    flex-direction: column;
    flex-grow: 1;
  }
  .card-content h3 {
    margin: 0 0 8px 0;
    font-size: 18px;
    color: #202124;
  }
  .card-content p {
    margin: 0 0 16px 0;
    font-size: 14px;
    color: #5f6368;
    flex-grow: 1;
  }
  .buy-btn {
    display: inline-block;
    padding: 10px 0;
    text-align: center;
    background-color: #34a853;
    color: white;
    text-decoration: none;
    font-weight: 500;
    border-radius: 8px;
    transition: background-color 0.2s ease;
    user-select: none;
    margin-bottom: 10px;
  }
  .buy-btn:hover {
    background-color: #2c8c43;
  }
  .delete-btn {
    background-color: #d93025;
    color: white;
    border: none;
    border-radius: 8px;
    font-weight: 500;
    padding: 10px 0;
    width: 100%;
    cursor: pointer;
    transition: background-color 0.2s ease;
    user-select: none;
    margin-top: auto;
  }
  .delete-btn:hover {
    background-color: #a52714;
  }
  .edit-btn {
    background-color: #1a73e8;
    color: white;
    border: none;
    border-radius: 8px;
    font-weight: 500;
    padding: 10px 0;
    width: 100%;
    cursor: pointer;
    transition: background-color 0.2s ease;
    user-select: none;
    margin-top: 10px;
  }
  .edit-btn:hover {
    background-color: #155ab6;
  }
  .hidden {
    display: none;
  }
  /* panel dodawania/edycji */
  #add-item-panel {
    position: fixed;
    top: 80px;
    right: 20px;
    width: 320px;
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 4px 24px rgba(0,0,0,0.12);
    padding: 20px;
    z-index: 105;
    display: none;
    flex-direction: column;
    gap: 12px;
  }
  #add-item-panel label {
    font-size: 14px;
    color: #3c4043;
    margin-bottom: 4px;
    display: block;
    font-weight: 500;
  }
  #add-item-panel input[type=text],
  #add-item-panel textarea,
  #add-item-panel input[type=url],
  #add-item-panel input[type=file] {
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #dadce0;
    font-size: 14px;
    width: 100%;
    box-sizing: border-box;
    transition: border-color 0.2s ease;
  }
  #add-item-panel input[type=text]:focus,
  #add-item-panel textarea:focus,
  #add-item-panel input[type=url]:focus,
  #add-item-panel input[type=file]:focus {
    border-color: #1a73e8;
    outline: none;
  }
  #add-item-panel textarea {
    resize: vertical;
    min-height: 60px;
  }
  #add-item-panel button {
    padding: 12px;
    background-color: #1a73e8;
    border: none;
    border-radius: 8px;
    color: white;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.2s ease;
    user-select: none;
  }
  #add-item-panel button:hover {
    background-color: #155ab6;
  }
  /* plusik z napisem dodaj */
  #add-btn-wrapper {
    width: 280px;
    margin: 40px auto 0 auto;
    cursor: pointer;
    user-select: none;
    text-align: center;
  }
  #add-btn-wrapper:hover {
    opacity: 0.85;
  }
  #add-btn {
    width: 60px;
    height: 60px;
    margin: 0 auto 8px auto;
    background-color: #1a73e8;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 36px;
    color: white;
    line-height: 1;
    font-weight: 700;
  }
  #add-btn-text {
    font-weight: 600;
    font-size: 16px;
    color: #1a73e8;
  }
  /* modal potwierdzenia usuniecia */
  #confirm-modal {
    position: fixed;
    top: 0;
    left: 0;
    right:0;
    bottom:0;
    background: rgba(32,33,36,0.6);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 200;
  }
  #confirm-box {
    background: white;
    border-radius: 12px;
    padding: 24px;
    width: 320px;
    box-sizing: border-box;
    text-align: center;
  }
  #confirm-box p {
    margin-bottom: 24px;
    font-weight: 600;
    font-size: 18px;
    color: #202124;
  }
  #confirm-buttons {
    display: flex;
    justify-content: space-around;
  }
  #confirm-buttons button {
    padding: 12px 28px;
    font-weight: 600;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    user-select: none;
  }
  #confirm-yes {
    background-color: #d93025;
    color: white;
  }
  #confirm-yes:hover {
    background-color: #a52714;
  }
  #confirm-no {
    background-color: #5f6368;
    color: white;
  }
  #confirm-no:hover {
    background-color: #3c4043;
  }
</style>
</head>
<body>
<header>
  <h1 class="main-title">FireReps Spreadsheet</h1>
  <button id="login-btn">Zaloguj się</button>
</header>

<div id="add-btn-wrapper" class="hidden" title="Dodaj nowy przedmiot">
  <div id="add-btn">+</div>
  <div id="add-btn-text">Dodaj</div>
</div>

<div id="item-container">
  <!-- tu bedą itemy -->
</div>

<div id="add-item-panel">
  <h2 id="panel-title">Dodaj przedmiot</h2>
  <label for="item-name">Nazwa przedmiotu</label>
  <input type="text" id="item-name" placeholder="np. Replika zegarka" />
  <label for="item-description">Opis</label>
  <textarea id="item-description" placeholder="Opis przedmiotu"></textarea>
  <label for="item-link">Link do przedmiotu</label>
  <input type="url" id="item-link" placeholder="https://example.com" />
  <label for="item-image">Zdjęcie (plik jpg/png)</label>
  <input type="file" id="item-image" accept="image/png, image/jpeg" />
  <button id="save-item-btn">Zapisz</button>
  <button id="cancel-item-btn" style="background:#5f6368;margin-top:8px;">Anuluj</button>
</div>

<div id="confirm-modal">
  <div id="confirm-box">
    <p>Czy na pewno chcesz usunąć ten przedmiot?</p>
    <div id="confirm-buttons">
      <button id="confirm-yes">Usuń</button>
      <button id="confirm-no">Anuluj</button>
    </div>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
  import { getDatabase, ref, onValue, push, update, remove } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-database.js";
  import { getStorage, ref as sRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-storage.js";

  // config firebase podmien tutaj na swoje
  const firebaseConfig = {
    apiKey: "AIzaSyB7tQvTVeG-WlBcvTByiKW7GfPpD52vDGw",
    authDomain: "spridszit-firerepy.firebaseapp.com",
    databaseURL: "https://spridszit-firerepy-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "spridszit-firerepy",
    storageBucket: "spridszit-firerepy.appspot.com",
    messagingSenderId: "963006920352",
    appId: "1:963006920352:web:58538b879f004c02873bc5"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const storage = getStorage(app);

  const adminPassword = "fi123re987re098ps321"; // ustaw swoje haslo admina

  const loginBtn = document.getElementById("login-btn");
  const addBtnWrapper = document.getElementById("add-btn-wrapper");
  const addBtn = document.getElementById("add-btn");
  const itemContainer = document.getElementById("item-container");

  const addItemPanel = document.getElementById("add-item-panel");
  const panelTitle = document.getElementById("panel-title");
  const itemNameInput = document.getElementById("item-name");
  const itemDescriptionInput = document.getElementById("item-description");
  const itemLinkInput = document.getElementById("item-link");
  const itemImageInput = document.getElementById("item-image");
  const saveItemBtn = document.getElementById("save-item-btn");
  const cancelItemBtn = document.getElementById("cancel-item-btn");

  const confirmModal = document.getElementById("confirm-modal");
  const confirmYes = document.getElementById("confirm-yes");
  const confirmNo = document.getElementById("confirm-no");

  let isAdmin = false;
  let editingItemId = null;

  // zaloguj albo wyloguj
  loginBtn.onclick = () => {
    if (!isAdmin) {
      const pwd = prompt("Podaj hasło administratora:");
      if (pwd === adminPassword) {
        isAdmin = true;
        loginBtn.textContent = "Wyloguj się";
        addBtnWrapper.classList.remove("hidden");
        loadItems();
      } else {
        alert("Niepoprawne hasło");
      }
    } else {
      isAdmin = false;
      loginBtn.textContent = "Zaloguj się";
      addBtnWrapper.classList.add("hidden");
      editingItemId = null;
      addItemPanel.style.display = "none";
      loadItems();
    }
  };

  addBtnWrapper.onclick = () => {
    editingItemId = null;
    panelTitle.textContent = "Dodaj przedmiot";
    itemNameInput.value = "";
    itemDescriptionInput.value = "";
    itemLinkInput.value = "";
    itemImageInput.value = "";
    addItemPanel.style.display = "flex";
  };

  cancelItemBtn.onclick = () => {
    addItemPanel.style.display = "none";
  };

  saveItemBtn.onclick = async () => {
    const name = itemNameInput.value.trim();
    const desc = itemDescriptionInput.value.trim();
    const link = itemLinkInput.value.trim();
    const file = itemImageInput.files[0];

    if (!name || !desc || !link || (!file && !editingItemId)) {
      alert("Wypełnij wszystkie pola i wybierz zdjęcie");
      return;
    }

    saveItemBtn.disabled = true;
    saveItemBtn.textContent = "Zapisuję...";

    try {
      let imageUrl = null;

      if (file) {
        // upload obrazka
        const imageRef = sRef(storage, 'images/' + Date.now() + '-' + file.name);
        const snapshot = await uploadBytes(imageRef, file);
        imageUrl = await getDownloadURL(snapshot.ref);
      } else if (editingItemId) {
        // jak edytujesz i nie zmieniasz obrazka to bierz stare url
        const oldItem = items[editingItemId];
        imageUrl = oldItem.imageUrl;
      }

      if (editingItemId) {
        // update
        const updates = {};
        updates['/items/' + editingItemId] = {
          name,
          description: desc,
          link,
          imageUrl
        };
        await update(ref(db), updates);
      } else {
        // dodaj nowy
        await push(ref(db, 'items'), {
          name,
          description: desc,
          link,
          imageUrl
        });
      }
      addItemPanel.style.display = "none";
    } catch (e) {
      alert("Błąd przy zapisie: " + e.message);
    }

    saveItemBtn.disabled = false;
    saveItemBtn.textContent = "Zapisz";
  };

  let items = {};

  function createItemCard(id, data) {
    const card = document.createElement("div");
    card.className = "item-card";

    const img = document.createElement("img");
    img.src = data.imageUrl;
    img.alt = data.name;
    card.appendChild(img);

    const content = document.createElement("div");
    content.className = "card-content";

    const title = document.createElement("h3");
    title.textContent = data.name;
    content.appendChild(title);

    const desc = document.createElement("p");
    desc.textContent = data.description;
    content.appendChild(desc);

    const buyBtn = document.createElement("a");
    buyBtn.className = "buy-btn";
    buyBtn.textContent = "Kup";
    buyBtn.href = data.link;
    buyBtn.target = "_blank";
    buyBtn.rel = "noopener noreferrer";
    content.appendChild(buyBtn);

    if (isAdmin) {
      const editBtn = document.createElement("button");
      editBtn.className = "edit-btn";
      editBtn.textContent = "Edytuj";
      editBtn.onclick = () => {
        editingItemId = id;
        panelTitle.textContent = "Edytuj przedmiot";
        itemNameInput.value = data.name;
        itemDescriptionInput.value = data.description;
        itemLinkInput.value = data.link;
        itemImageInput.value = "";
        addItemPanel.style.display = "flex";
      };
      content.appendChild(editBtn);

      const deleteBtn = document.createElement("button");
      deleteBtn.className = "delete-btn";
      deleteBtn.textContent = "Usuń";
      deleteBtn.onclick = () => {
        confirmModal.style.display = "flex";
        confirmYes.onclick = async () => {
          confirmModal.style.display = "none";
          await remove(ref(db, 'items/' + id));
        };
        confirmNo.onclick = () => {
          confirmModal.style.display = "none";
        };
      };
      content.appendChild(deleteBtn);
    }

    card.appendChild(content);
    return card;
  }

  function loadItems() {
    itemContainer.innerHTML = "";
    addBtnWrapper.classList.toggle("hidden", !isAdmin);
    onValue(ref(db, "items"), (snapshot) => {
      items = snapshot.val() || {};
      itemContainer.innerHTML = "";
      for (const [id, data] of Object.entries(items)) {
        const card = createItemCard(id, data);
        itemContainer.appendChild(card);
      }
    }, { onlyOnce: true });
  }

  loadItems();
</script>
</body>
</html>
