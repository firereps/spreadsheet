<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>FireReps Spreadsheet</title>
<style>
  :root {
    --background-color: #111827; --primary-color: #1F2937; --border-color: #374151;
    --text-color: #F9FAFB; --text-color-muted: #9CA3AF; --accent-color: #DC2626;
    --accent-hover-color: #B91C1C; --tag-new-bg: #e36209; --tag-best-bg: #dcb32a;
    --tag-budget-bg: #2ea043;
  }
  body { margin: 0; background-color: var(--background-color); font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; color: var(--text-color); }
  .main-header { background-color: var(--primary-color); border-bottom: 1px solid var(--border-color); padding: 0 24px; height: 60px; display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 100; }
  .header-title { font-size: 20px; font-weight: 600; user-select: none; }
  .header-actions button { background-color: var(--accent-color); color: white; border: none; padding: 8px 16px; border-radius: 6px; font-weight: 600; font-size: 14px; cursor: pointer; transition: background-color 0.2s ease; }
  .header-actions button:hover { background-color: var(--accent-hover-color); }
  .header-actions button#logout-button { background-color: #4B5563; margin-left: 10px; }
  .header-actions button#logout-button:hover { background-color: #374151; }

  .controls-container { padding: 16px 24px; display: flex; gap: 12px; }
  .filter-container { position: relative; }
  .filter-button { display: flex; align-items: center; gap: 8px; background-color: var(--accent-color); color: white; border: none; padding: 10px 16px; border-radius: 6px; font-weight: 600; font-size: 14px; cursor: pointer; transition: background-color 0.2s ease; }
  .filter-button:hover { background-color: var(--accent-hover-color); }
  .filter-dropdown { display: none; position: absolute; top: 110%; left: 0; background-color: var(--primary-color); border: 1px solid var(--border-color); border-radius: 6px; z-index: 110; min-width: 150px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
  .filter-dropdown button { display: block; width: 100%; padding: 10px 12px; background: none; border: none; color: var(--text-color); text-align: left; cursor: pointer; }
  .filter-dropdown button:hover { background-color: var(--border-color); }
  .filter-dropdown button.active { background-color: var(--accent-color); color: white; font-weight: 600; }
  .search-input { flex-grow: 1; background-color: var(--primary-color); border: 1px solid var(--border-color); border-radius: 6px; color: var(--text-color); padding: 0 12px; font-size: 14px; }
  .search-input::placeholder { color: var(--text-color-muted); }

  #items-container { max-width: 1400px; margin: 24px auto 40px; display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px; padding: 0 24px; }
  .item-card { background: var(--primary-color); border: 1px solid var(--border-color); border-radius: 8px; overflow: hidden; display: flex; flex-direction: column; user-select: none; transition: transform 0.2s ease, box-shadow 0.2s ease; position: relative; }
  .item-card:hover { transform: translateY(-4px); box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3); }
  .item-image-wrapper { position: relative; background-color: #fff; }
  .item-card img { width: 100%; aspect-ratio: 1 / 1; object-fit: cover; display: block; }
  .card-badges { position: absolute; top: 10px; right: 10px; display: flex; flex-direction: column; gap: 4px; }
  .badge { color: white; padding: 2px 8px; font-size: 10px; font-weight: 700; border-radius: 4px; text-transform: uppercase; }
  .badge-new { background-color: var(--tag-new-bg); }
  .badge-best { background-color: var(--tag-best-bg); }
  .badge-budget { background-color: var(--tag-budget-bg); }
  .item-info { padding: 12px; display: flex; flex-direction: column; flex-grow: 1; }
  .item-title { font-weight: 600; font-size: 16px; color: var(--text-color); margin-bottom: 4px; }
  .item-description { font-size: 12px; color: var(--text-color-muted); margin-bottom: 8px; min-height: 16px; }
  .item-price { font-weight: 600; font-size: 16px; color: var(--text-color); margin-bottom: 12px; }
  .item-buy-button { margin-top: auto; display: block; text-align: center; background-color: var(--accent-color); color: white; padding: 10px; border-radius: 6px; font-weight: 600; text-decoration: none; transition: background-color 0.2s ease; }
  .item-buy-button:hover { background-color: var(--accent-hover-color); }
  .item-buy-button.disabled { background-color: var(--border-color); color: var(--text-color-muted); cursor: not-allowed; }
  .item-delete-button { position: absolute; top: 8px; left: 8px; background-color: #ef4444; color: white; border: none; border-radius: 50%; width: 28px; height: 28px; font-size: 16px; cursor: pointer; display: flex; align-items: center; justify-content: center; z-index: 5; transition: background-color 0.2s; }
  .item-delete-button:hover { background-color: #dc2626; }

  .modal-overlay { display: none; position: fixed; z-index: 1100; inset: 0; background: rgba(0,0,0,0.75); display: flex; justify-content: center; align-items: center; }
  .modal-content { background: var(--primary-color); padding: 25px 30px; border-radius: 12px; width: 380px; box-shadow: 0 0 20px rgba(0,0,0,0.5); position: relative; }
  .modal-content h2 { color: var(--text-color); font-weight: 800; font-size: 22px; margin: 0 0 20px 0; text-align: center; }
  .modal-content .form-group { margin-bottom: 15px; }
  .modal-content label { display: block; margin-bottom: 5px; font-size: 14px; color: var(--text-color-muted); }
  .modal-content input[type="text"], .modal-content input[type="url"], .modal-content input[type="number"], .modal-content input[type="password"] { width: calc(100% - 24px); padding: 12px; border-radius: 8px; border: 1px solid var(--border-color); background-color: var(--background-color); color: var(--text-color); font-size: 16px; }
  .tag-selection { display: flex; gap: 15px; align-items: center; }
  .tag-selection label { display: flex; align-items: center; gap: 8px; font-size: 14px; color: var(--text-color); cursor: pointer; }
  .tag-selection input[type="checkbox"] { width: 16px; height: 16px; accent-color: var(--accent-color); }
  .modal-content .modal-actions { display: flex; gap: 10px; margin-top: 20px; }
  .modal-content .modal-actions button { flex-grow: 1; border: none; padding: 12px; border-radius: 8px; font-weight: 700; cursor: pointer; font-size: 16px; transition: background-color 0.2s ease; }
  .modal-content .modal-actions .btn-primary { background-color: var(--accent-color); color: white; }
  .modal-content .modal-actions .btn-primary:hover { background-color: var(--accent-hover-color); }
  .modal-content .modal-actions .btn-secondary { background-color: var(--border-color); color: var(--text-color); }
  .modal-content .modal-actions .btn-secondary:hover { background-color: #4b5563; }
  .loader { display: none; position: absolute; inset: 0; background: rgba(31, 41, 55, 0.8); border-radius: 12px; justify-content: center; align-items: center; }
  .spinner { width: 40px; height: 40px; border: 4px solid var(--border-color); border-top-color: var(--accent-color); border-radius: 50%; animation: spin 1s linear infinite; }
  @keyframes spin { to { transform: rotate(360deg); } }
</style>
</head>
<body>

<header class="main-header">
  <div class="header-title">FireReps Spreadsheet</div>
  <div class="header-actions">
    <button id="login-button">Zaloguj siƒô</button>
    <button id="add-item-button" style="display:none;">Dodaj przedmiot</button>
    <button id="logout-button" style="display:none;">Wyloguj siƒô</button>
  </div>
</header>

<main>
  <div class="controls-container">
    <div class="filter-container">
      <button class="filter-button" id="filter-btn">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2 4h12M4 8h8M6.5 12h3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg>
        <span>Filtry</span>
      </button>
      <div class="filter-dropdown" id="filter-dropdown">
          <button data-filter="all" class="active">Wszystkie</button>
          <button data-filter="isNew">‚ù§Ô∏è NEW</button>
          <button data-filter="isBest">‚≠ê BEST</button>
          <button data-filter="isBudget">üí∏ BUDGET</button>
      </div>
    </div>
    <input type="search" class="search-input" id="search-input" placeholder="Wyszukaj po nazwie...">
  </div>
  <div id="items-container"></div>
</main>

<!-- Modal logowania -->
<div id="login-modal" class="modal-overlay">
  <div class="modal-content">
    <h2>Logowanie Admin</h2>
    <div class="form-group"><input id="login-username" type="text" placeholder="Nazwa uzytkownika" /></div>
    <div class="form-group"><input id="login-password" type="password" placeholder="Haslo" /></div>
    <div class="modal-actions"><button id="login-submit" class="btn-primary">Zaloguj</button></div>
  </div>
</div>

<!-- Modal dodawania przedmiotu -->
<div id="add-item-modal" class="modal-overlay">
    <div class="modal-content">
        <h2>Dodaj nowy przedmiot</h2>
        <div class="form-group"><label for="item-name-input">Nazwa</label><input id="item-name-input" type="text" /></div>
        <div class="form-group"><label for="item-desc-input">Opis</label><input id="item-desc-input" type="text" /></div>
        <div class="form-group"><label for="item-price-input">Cena</label><input id="item-price-input" type="number" /></div>
        <div class="form-group"><label for="item-link-input">Link do zakupu</label><input id="item-link-input" type="url" /></div>
        <div class="form-group"><label for="item-image-input">Link do zdjƒôcia</label><input id="item-image-input" type="url" /></div>
        <div class="form-group">
            <label>Tagi</label>
            <div class="tag-selection">
                <label><input type="checkbox" id="tag-new"> NEW</label>
                <label><input type="checkbox" id="tag-best"> BEST</label>
                <label><input type="checkbox" id="tag-budget"> BUDGET</label>
            </div>
        </div>
        <div class="modal-actions">
            <button id="add-item-cancel" class="btn-secondary">Anuluj</button>
            <button id="add-item-submit" class="btn-primary">Dodaj</button>
        </div>
        <div class="loader" id="add-item-loader"><div class="spinner"></div></div>
    </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, onValue, push, set, remove } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = { /* Twoja konfiguracja Firebase */ };
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// Globalne stany
const ADMIN_USER = "ifirelovereps";
const ADMIN_PASS = "fi123re987re098ps321";
let isAdmin = false;
let allItems = {};
let activeFilter = 'all';
let searchTerm = '';

// Elementy UI
const loginButton = document.getElementById("login-button"), logoutButton = document.getElementById("logout-button");
const addItemButton = document.getElementById("add-item-button"), itemsContainer = document.getElementById("items-container");
const searchInput = document.getElementById("search-input");
const filterBtn = document.getElementById('filter-btn'), filterDropdown = document.getElementById('filter-dropdown');

// Modale
const loginModal = document.getElementById("login-modal"), addItemModal = document.getElementById("add-item-modal");
const loginSubmit = document.getElementById("login-submit"), addItemSubmit = document.getElementById("add-item-submit");
const addItemCancel = document.getElementById("add-item-cancel"), addItemLoader = document.getElementById("add-item-loader");

// Funkcje pomocnicze
const showModal = (modal) => modal.style.display = "flex";
const hideModal = (modal) => modal.style.display = "none";

// Logika UI
const updateUIForAdmin = () => { loginButton.style.display = "none"; addItemButton.style.display = "inline-block"; logoutButton.style.display = "inline-block"; displayFilteredItems(); };
const updateUIForGuest = () => { loginButton.style.display = "inline-block"; addItemButton.style.display = "none"; logoutButton.style.display = "none"; displayFilteredItems(); };

// G≈Ç√≥wna funkcja renderujƒÖca
function renderItems(itemsToRender) {
  itemsContainer.innerHTML = "";
  for (const key in itemsToRender) {
    const item = itemsToRender[key];
    const card = document.createElement("div");
    card.className = "item-card";

    let badgesHTML = '';
    if (item.tags) {
        if (item.tags.isNew) badgesHTML += `<span class="badge badge-new">‚ù§Ô∏è NEW</span>`;
        if (item.tags.isBest) badgesHTML += `<span class="badge badge-best">‚≠ê BEST</span>`;
        if (item.tags.isBudget) badgesHTML += `<span class="badge badge-budget">üí∏ BUDGET</span>`;
    }

    card.innerHTML = `
      ${isAdmin ? `<button class="item-delete-button" data-key="${key}" title="Usu≈Ñ przedmiot">√ó</button>` : ''}
      <div class="item-image-wrapper">
        <img src="${item.image || 'https://via.placeholder.com/220'}" alt="${item.name}" loading="lazy">
        <div class="card-badges">${badgesHTML}</div>
      </div>
      <div class="item-info">
        <div class="item-title">${item.name || 'Brak nazwy'}</div>
        <div class="item-description">${item.description || ''}</div>
        <div class="item-price">${item.price ? `${item.price} PLN` : ''}</div>
        ${item.purchaseLink ? `<a href="${item.purchaseLink}" class="item-buy-button" target="_blank" rel="noopener noreferrer">Kup</a>` : `<button class="item-buy-button disabled" disabled>Brak linku</button>`}
      </div>`;
    itemsContainer.appendChild(card);
  }
}

function displayFilteredItems() {
    let filteredItems = { ...allItems };

    // 1. Filtrowanie po tagu
    if (activeFilter !== 'all') {
        filteredItems = Object.fromEntries(
            Object.entries(filteredItems).filter(([key, item]) => item.tags && item.tags[activeFilter])
        );
    }

    // 2. Filtrowanie po nazwie
    if (searchTerm) {
        const lowerCaseSearchTerm = searchTerm.toLowerCase();
        filteredItems = Object.fromEntries(
            Object.entries(filteredItems).filter(([key, item]) => item.name.toLowerCase().includes(lowerCaseSearchTerm))
        );
    }
    
    renderItems(filteredItems);
}

// Logika event√≥w
loginButton.onclick = () => showModal(loginModal);
logoutButton.onclick = () => { isAdmin = false; updateUIForGuest(); };
addItemButton.onclick = () => {
    // Resetuj formularz przed pokazaniem
    document.getElementById('item-name-input').value = ''; document.getElementById('item-desc-input').value = '';
    document.getElementById('item-price-input').value = ''; document.getElementById('item-link-input').value = '';
    document.getElementById('item-image-input').value = ''; document.getElementById('tag-new').checked = false;
    document.getElementById('tag-best').checked = false; document.getElementById('tag-budget').checked = false;
    showModal(addItemModal);
};
addItemCancel.onclick = () => hideModal(addItemModal);
loginModal.onclick = (e) => { if (e.target === loginModal) hideModal(loginModal); };
addItemModal.onclick = (e) => { if (e.target === addItemModal) hideModal(addItemModal); };

loginSubmit.onclick = () => {
  if (document.getElementById("login-username").value.trim() === ADMIN_USER && document.getElementById("login-password").value.trim() === ADMIN_PASS) {
    isAdmin = true; hideModal(loginModal); updateUIForAdmin();
  } else { alert("Niepoprawny login lub has≈Ço"); }
};

addItemSubmit.onclick = async () => {
  const name = document.getElementById('item-name-input').value.trim();
  const price = document.getElementById('item-price-input').value.trim();
  const purchaseLink = document.getElementById('item-link-input').value.trim();
  const image = document.getElementById('item-image-input').value.trim();

  if (!name || !price || !purchaseLink || !image) { alert("Wype≈Çnij wymagane pola: Nazwa, Cena, Link do zakupu, Link do zdjƒôcia."); return; }
  
  const newItemData = {
    name, description: document.getElementById('item-desc-input').value.trim(),
    price: Number(price), purchaseLink, image,
    tags: {
        isNew: document.getElementById('tag-new').checked,
        isBest: document.getElementById('tag-best').checked,
        isBudget: document.getElementById('tag-budget').checked,
    },
    createdAt: new Date().toISOString()
  };

  addItemLoader.style.display = 'flex';
  try {
    await set(push(ref(db, 'items')), newItemData);
    hideModal(addItemModal);
  } catch (error) { console.error("B≈ÇƒÖd:", error); alert("WystƒÖpi≈Ç b≈ÇƒÖd."); } 
  finally { addItemLoader.style.display = 'none'; }
};

// Event Delegation dla przycisk√≥w usuwania
itemsContainer.onclick = async (e) => {
    if (e.target.classList.contains('item-delete-button')) {
        const key = e.target.dataset.key;
        if (confirm('Czy na pewno chcesz usunƒÖƒá ten przedmiot? Tej operacji nie mo≈ºna cofnƒÖƒá.')) {
            try {
                await remove(ref(db, `items/${key}`));
            } catch (error) {
                console.error("B≈ÇƒÖd usuwania:", error);
                alert("Nie uda≈Ço siƒô usunƒÖƒá przedmiotu.");
            }
        }
    }
};

// Logika filtrowania i wyszukiwania
searchInput.addEventListener('input', (e) => {
    searchTerm = e.target.value.trim();
    displayFilteredItems();
});

filterBtn.addEventListener('click', () => {
    filterDropdown.style.display = filterDropdown.style.display === 'block' ? 'none' : 'block';
});

filterDropdown.addEventListener('click', (e) => {
    if (e.target.tagName === 'BUTTON') {
        // Zdejmij klasƒô 'active' ze wszystkich przycisk√≥w
        filterDropdown.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
        // Dodaj klasƒô 'active' do klikniƒôtego
        e.target.classList.add('active');
        activeFilter = e.target.dataset.filter;
        displayFilteredItems();
        filterDropdown.style.display = 'none'; // Schowaj menu po wyborze
    }
});

// Chowanie menu filtr√≥w po klikniƒôciu poza nim
document.addEventListener('click', (e) => {
    if (!filterBtn.contains(e.target) && !filterDropdown.contains(e.target)) {
        filterDropdown.style.display = 'none';
    }
});

// Inicjalizacja
updateUIForGuest();
onValue(ref(db, "items"), (snapshot) => {
    allItems = snapshot.val() || {};
    displayFilteredItems();
});

</script>
</body>
</html>
